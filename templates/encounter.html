<title>Encounter</title>
<style>
     body {background:white;     font:15px arial,sans-serif;}
     table {
     	border-collapse:collapse;
     	width:100%;
     }
 td, th {
 	border:1px solid #000;
 	padding:10px;
 	text-align:left;
 	vertical-align:top;
 }
</style>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//cdn.jsdelivr.net/jplayer/2.6.1/jquery.jplayer.min.js"></script>
<link href="//vjs.zencdn.net/4.2/video-js.css" rel="stylesheet">
<script src="//vjs.zencdn.net/4.2/video.js"></script>
<script>
$(function() {
     window.player = videojs('myvideo');
     
     window.player.ready(function() {
         console.log('player is ready');
     });    
     setInterval(function() {
         $('#current_time').html(Math.floor( window.player.currentTime()));
         $('#'+Math.floor( window.player.currentTime())+'_seconds').css({'background': 'yellow'});
     }, 500);
});

</script>
 
<a href="/patient/{{ patient.id }}/">Go back to patient {{ patient.get_full_name }}</a>
{% if not encounter.audio %}
<form action="" method="post"
enctype="multipart/form-data">
<label for="file">Audio file:</label>
<input type="file" name="audio_file" id="file"><br>
<input type="submit" name="submit" value="Submit">
</form>
{% else %}
<a href="/media/{{ encounter.audio }}">Audio file</a>
{% endif %}
{% if not encounter.video %}
<form action="" method="post"
enctype="multipart/form-data">
<label for="file">Video file:</label>
<input type="file" name="video_file" id="file"><br>

<input type="submit" name="submit" value="Submit">
</form>
{% else %}
<a href="/media/{{ encounter.video }}">Video file</a>
{% endif %}
{% if not encounter.note %}
<form action="" method="post">
<strong>Note:</strong> <textarea name="note"></textarea>
<input type="submit" name="submit" value="Submit">
</form>
{% else %}
<strong>Note:</strong> {{ encounter.note }}
{% endif %}
{% if encounter.video %}
  <video id="myvideo" class="video-js vjs-default-skin" controls preload="auto" width="640px" height="360px" data-setup='{}'>
   <source src="/media/{{ encounter.video }}" type='video/mp4'>
  </video><span id="current_time"></span>
{% endif %}
<table>

<tr><th style="width:20px">Time (24 hour)</th><th style="width:20px">Video timestamp</th><th>Summary</th></tr>
<tr id="{{ event.video_seconds }}_seconds"><td>{{ encounter.starttime|date:"H:i:s" }}</td><td>
<input type="button" value="0:00" onclick="window.player.play();window.player.currentTime(0);" />
</td><td>Encounter started</td>
{% for event in events %}
<tr><td>{{ event.datetime|date:"H:i:s" }}</td>
<td><input type="button" value="{{ event.video_timestamp }}" onclick="window.player.play();window.player.currentTime({{ event.video_seconds }});" />
</td><td>{{ event.event.summary|safe }}</td>
{% endfor %}
<tr><td>{{ encounter.stoptime|date:"H:i:s" }}</td><td>seconds</td><td>Encounter stopped</td>
</table>
