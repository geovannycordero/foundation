<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingOne" ng-click="open_colon()">
            <div ng-show="!show_colon_collapse">
                <i class="fa fa-caret-right" aria-hidden="true"></i>
                Colon cancer screening: {{ header }}
            </div>
            <div ng-show="show_colon_collapse">
                <i class="fa fa-caret-down" aria-hidden="true"></i>
                Colon cancer screening: {{ header }}
            </div>
        </div>
        <div ng-show="show_colon_collapse">
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="io-box">
                                    <div class="row" ng-if="colon_cancer.colon_studies.length > 0">
                                        <div class="col-md-12">
                                            <p><b>Most recent study</b></p>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    {{ colon_cancer.colon_studies[0].finding}}
                                                </div>
                                                <div class="col-md-6"></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">on
                                                    {{ colon_cancer.colon_studies[0].study_date|date:'M/d/yyyy'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">{{ colon_cancer.colon_studies[0].result}}
                                                </div>
                                                <div class="col-md-6"><a href class="btn btn-default">View
                                                    report</a></div>
                                            </div>
                                            <p ng-if="colon_cancer.colon_studies[0].note">Note:
                                                {{ colon_cancer.colon_studies[0].note}}</p>
                                            <p>updated by
                                                {{ colon_cancer.colon_studies[0].last_updated_user.user.username}}
                                                on
                                                {{ colon_cancer.colon_studies[0].last_updated_date|date:'M/d/yyyy'}}</p>
                                            <p>
                                                <a href="#/colon_cancer/{{ colon_cancer.id }}/edit_study/
                                                        {{ colon_cancer.colon_studies[0].id}}/"
                                                   class="btn btn-default">Edit</a>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="row" ng-if="colon_cancer.colon_studies.length == 0">
                                        <div class="col-md-12">
                                            no study has been entered. normal risk screening starts at age 50.
                                            high risk screening starts at age 40, or 10 years before first
                                            degree relative with colorectal cancer or adenomatous polyps.
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6"><a
                                                href="#/colon_cancer/{{ colon_cancer.id }}/add_new_study"
                                                class="btn btn-default">Add new study</a></div>
                                        <div class="col-md-6">
                                            <div class="row" ng-init="see_past_studies=false">
                                                <div class='col-md-12'>
                                                    <button class='btn btn-default'
                                                            ng-click="see_past_studies=!see_past_studies">View
                                                        past studies
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" ng-show="see_past_studies">
                                        <div class='col-md-12'>
                                            <h2>Past studies:</h2>
                                        </div>
                                        <div class='col-md-12' ng-repeat="study in colon_cancer.colon_studies"
                                             ng-if="!$first">
                                            Study:
                                            {{ study.finding }}, {{ study.result }}.
                                            <span ng-if="study.study_date">Date: {{ study.study_date|date:'M/d/yyyy' }}.</span>
                                            <span ng-if="study.author">Author: {{ study.author.user.first_name }} {{ study.author.user.last_name }}.</span>
                                            <span ng-if="study.created_on">Date added: {{ study.created_on|date:'M/d/yyyy' }}.</span>
                                            <p ng-if="study.note">Note: {{ study.note }}</p>
                                            <p>
                                                <a href="#/colon_cancer/{{ colon_cancer.id }}/edit_study/{{ study.id }}/"
                                                   class="btn btn-link"
                                                   ng-if="active_user.role == 'physician' || active_user.role == 'admin' || active_user.id == study.author.id">Edit</a>
                                                <a href class="btn btn-link" ng-click="delete_study(study)"
                                                   ng-if="active_user.role == 'physician' || active_user.role == 'admin'">Delete</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="io-box" ng-init="show_factors=false;">
                                    <p><b>Risk:</b> {{ colon_cancer.risk }}</p>
                                    <p ng-repeat="factor in factors" ng-if="factor.checked">{{ factor.value }}</p>
                                    <p ng-if="colon_cancer.last_risk_updated_user">updated by
                                        {{ colon_cancer.last_risk_updated_user.username }} on
                                        {{ colon_cancer.last_risk_updated_date|date:'M/d/yyyy' }}</p>
                                    <p><a href class="btn btn-default" ng-click="show_factors=!show_factors;">Update</a>
                                    </p>
                                    <form ng-show="show_factors">
                                        <div ng-repeat="factor in factors">
                                            <label><input type="checkbox" value="{{ factor.value }}"
                                                          ng-click="change_factor(factor)"
                                                          ng-model="factor.checked">{{ factor.value }}</label>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="io-box">
                                    <p><b>Plan</b></p>
                                    <p>Pending order:</p>
                                    <p ng-if='orders.length == 0'>
                                        No pending order</p>
                                    <div ng-if="orders.length > 0">
                                        <todo todo-list="orders" accomplished="false"
                                              show-problem="false"
                                              on-status-changed-success="todoStatusChanged"
                                              labels="labels" members="members"
                                              patient-id="patient_id" user-id="patient_id"
                                              active-user="active_user"></todo>
                                        <wave-spinner ng-if="todoIsLoading"></wave-spinner>
                                    </div>

                                    <div class='input-group'>
                                        <input type='text' ng-model='newTodo.name' title="Todo name"
                                               class="form-control" id='todoNameInput'>
                                        <span class="input-group-btn">
                                            <button type='submit' class='btn btn-default'
                                                    ng-click="addNewOrder(newTodo)"> Add new order</button>
                                        </span>
                                    </div>
                                    <br>
                                    <!--<p>-->
                                    <!--<a href="#/colon_cancer/{{colon_cancer.id}}/add_new_order"-->
                                    <!--class='btn btn-default'>Add new order</a></p>-->
                                    <p>
                                        <a href class='btn btn-default btn-block' ng-click="repeat_todo(todo_repeat)">Repeat
                                            {{ todo_repeat.name }} in {{ todo_repeat.year }} year<span
                                                    ng-if="todo_repeat.year > 1">s</span></a>
                                    </p>
                                    <div class="row">
                                        <div class="col-md-6"><a href class="btn btn-default"
                                                                 ng-click="refuse()">Refuse</a></div>
                                        <div class="col-md-6"><a href class="btn btn-default"
                                                                 ng-click="not_appropriate()">Not
                                            appropriate</a></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="io-box">
                                    <div class="row" ng-if="colon_cancer.colon_notes.length">
                                        <div class='col-md-12'
                                             ng-repeat="note in colon_cancer.colon_notes|orderBy:'datetime':true">
                                            <div ng-show="$index == 0 || show_note">
                                                <span ng-show="!note.edit">{{ note.author.username }}: {{ note.note }} {{ note.datetime|date:'M/d/yyyy' }}</span>
                                                <div ng-if="active_user.role == 'physician' || active_user.role == 'admin' || (active_user.role == 'patient' && active_user.id == note.author.profile.id)">
                                                    <div class="comment-box" ng-show="note.edit">
                                                        <input type='text' ng-model='note.note'>
                                                    </div>
                                                    <div ng-show="!note.edit">
                                                        <a href ng-click="toggleEditNote(note)">Edit</a>
                                                        <a href ng-click="deleteNote(note)">Delete</a>
                                                    </div>
                                                    <p ng-show="note.edit"><a href
                                                                              ng-click="toggleSaveNote(note)">Save</a>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" ng-init="show_note=false">
                                        <div class='col-md-12'>
                                            <button class='btn btn-default' ng-click="show_note=!show_note">
                                                <span ng-if="!show_note">Show more notes</span>
                                                <span ng-if="show_note">Show less notes</span>
                                            </button>
                                        </div>
                                    </div>
                                    </br>
                                    <div class="row" ng-init="toggle_add_note=false">
                                        <div class='col-md-12'>
                                            <button class='btn btn-default'
                                                    ng-click="toggle_add_note=!toggle_add_note">Add note
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row" ng-show="toggle_add_note">
                                        <div class='col-md-12'>
                                            <form class='form-inline'
                                                  ng-submit='toggle_add_note=!toggle_add_note; add_note(note_form)'>
                                                <div class='form-group'>
                                                    <label> Add </label>
                                                    <input type='text' class='form-control'
                                                           ng-model='note_form.note'>
                                                </div>
                                                <div class='form-group'>
                                                    <input type='submit' value='Submit' class='btn btn-default'>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
