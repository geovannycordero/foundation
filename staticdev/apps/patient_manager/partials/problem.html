<style type='text/css'>

#problem-header{

	z-index: 999;
	width: 1200px;
	margin: 0 auto;
	border-bottom: 1px solid #ccc;
	padding-top:7px;
	padding-bottom: 7px;
}

#problem-header.affix{
	top:0;
}

.problem-controlled{
	background-color: green;
	color:white;
}

.problem-uncontrolled{
	background-color: red;
	color: white;
}
</style>


<a href='#/'><b> Manage Patient </b></a>

<span class='text-default'>
	<i class='glyphicon glyphicon-menu-right'></i> 
</span>

<span class='text-muted'><b>  Problem: {{problem.problem_name}} </b></span>

<hr>

<div class='row' id='problem-header' fixed-zone offset-orientation='top' offset-top='100' ng-class='problem.is_controlled==true ? "problem-controlled" : "problem-uncontrolled"'>
<h4>  Problem : {{problem.problem_name}} </h4>
</div>

<hr>

<toaster-container></toaster-container>

<div class='row'>

	<div class='col-md-8'>


<div class='panel panel-default'>

	<div class='panel-heading'>Status</div>

	<div class='panel-body'>


<div class='row'>
	<div class='col-md-4'>
		<input type='checkbox' ng-model='problem.is_controlled' ng-disabled='!permitted(["set_problem_controlled"])'> 
		Is controlled
	</div>
	<div class='col-md-4'>
		<input type='checkbox' ng-model='problem.authenticated' ng-disabled='!permitted(["set_problem_authenticated"])'>
		Is authenticated
	</div>
	<div class='col-md-4'>
		<input type='checkbox' ng-model='problem.is_active'  ng-disabled='!permitted(["set_problem_active"])'>
		Is active
	</div>
</div>



	</div>

</div>



	</div>
	<div class='col-md-4'>

<div class='panel panel-default'>

	<div class='panel-heading'>Start Date</div>

	<div class='panel-body'>

		<form class='form form-inline' >

			<div class='form-group'>
				<input type='text' class='form-control' ng-model='problem.start_date'>

			</div>
			<div class='form-group'>
				<button ng-click='update_start_date()' class='btn btn-default' ng-show='permitted(["modify_problem"])'> Update </button>
			</div>	
		</form>

	</div>


	</div>

</div>

</div>



<div class='panel panel-default'>

	<div class='panel-heading'> Problem History </div>
	<div class='panel-body'>

		<form class='form' ng-submit='add_history_note(history_note_form)'>

			<div class='form-group'>
				<textarea ng-model='history_note_form.note' class='form-control ' style='height:125px;' required></textarea>
			</div>
			<div class='form-group'>
				<button type='submit' class='btn btn-default' ng-show="permitted(['modify_problem'])">
					Update
				</button>
			</div>
		</form>

		<span class='text-muted'> <i> Last updated by {{history_note.author.user.first_name}} 
			{{history_note.author.user.last_name}} @{{history_note.author.user.username}} - 
			{{history_note.author.role}} </i>
		</span>
	</div>

</div>


<div class='panel panel-default'>

	<div class='panel-heading'> Wiki Notes</div>

	<div class='panel-body'>

<div class='row'>

	<div class='col-md-12'>

		<form class='form' ng-submit='add_wiki_note(wiki_note_form)'>

			<div class='form-group'>
				<textarea ng-model='wiki_note_form.note' class='form-control' style='height:75px;' required></textarea>
			</div>
			<div class='form-group'>
				<button type='submit' class='btn btn-default'>
				 Add
				</button>
			</div>
		</form>
	</div>

</div>

<hr>

<div class='row'>

	<div class='col-md-6'>
		<b> Patient Notes </b> 

		<hr>

		<ul class='list-group'>

			<li ng-show='!patient_wiki_notes.length' class='list-group-item'> No Notes </li>
			<li ng-repeat='note in patient_wiki_notes' class='list-group-item'>
				<b> {{note.author.user.first_name}} {{note.author.user.last_name}} - {{note.author.user.username}} </b> : {{note.note}}
			</li>
		</ul>
	</div>

	<div class='col-md-6'>
		<b> Physician Notes </b>

		<hr>

		<ul class='list-group'>

			<li ng-show='!physician_wiki_notes.length' class='list-group-item'> No Notes </li>
			<li ng-repeat='note in physician_wiki_notes' class='list-group-item'>
				<b> {{note.author.user.first_name}} {{note.author.user.last_name}} - {{note.author.user.username}} </b> : {{note.note}}
			</li>
		</ul>
	</div>
</div>

<hr>

<div class='row'>
	<div class='col-md-12'>
		<button class='btn btn-link' ng-click='toggle_other_notes()'>
			<span ng-show='show_other_notes'>Hide Other Notes </span>
			<span ng-show='!show_other_notes'> Show Other Notes </span>
		</button>

		<ul class='list-group' ng-show='show_other_notes==true'>

			<li ng-show='!other_wiki_notes.length' class='list-group-item'> No Notes </li>
			<li ng-repeat='note in other_wiki_notes' class='list-group-item'>
				<b> {{note.author.user.first_name}} {{note.author.user.last_name}} - {{note.author.user.username}} </b> : {{note.note}}
			</li>
		</ul>


	</div>
</div>


	</div>

</div>





<div class='panel panel-default'>

	<div class='panel-heading'> Goals and Todos </div>


	<div class='panel-body'>


<div class='row'>

	<div class='col-md-6'>

		<b> Goals </b>
		
		<hr>

		<form class='form-inline' ng-submit='add_goal(goal_form)' ng-show='permitted(["add_goal"])'>
		
			<div class='form-group'>
				<label> Add </label>
				<input type='text' class='form-control' ng-model='goal_form.name'>
			</div>

			<div class='form-group'>
				<input type='submit' value='Submit' class='btn btn-default'>
			</div>
		<hr>
		</form>

		

		<ul class='list-group'>
			<li ng-show='!problem_goals.length'> No Goals </li>
			<li ng-repeat='goal in problem_goals' class='list-group-item' ng-class='goal.is_controlled==true ? "green-box" : "red-box" '>
				<a class='btn btn-default' href='#/goal/{{goal.id}}'> View </a>
				{{goal.goal}}
			</li>
		</ul>



	</div>

	<div class='col-md-6'>

		<b> Todo </b>
		<hr>  

		<form class='form-inline' ng-submit='add_todo(todo_form)' >

			<div class='form-group'>
				<label> Add </label>
				<input type='text' class='form-control' ng-model='todo_form.name'>
			</div>

			<div class='form-group'>
				<input type='submit' value='Submit' class='btn btn-default'>
			</div>


		</form>

		<hr>

		<ul class='list-group'>
			<li ng-show='!problem_todos.length'> No Todos </li>
			<li ng-repeat='todo in problem_todos' class='list-group-item'>
				 <input type='checkbox' ng-model='todo.accomplished'   ng-change='update_todo_status(todo)' ng-show='todo.accomplished==false'> &nbsp;&nbsp; {{todo.todo}}
			</li>
		</ul>

	</div>


</div>




	</div>


</div>


<div class='panel panel-default'>


	<div class='panel-heading'> Images </div>

	<div class='panel-body'>

		<div class='row' ng-show='permitted(["add_problem_image"])'>
			<div class='col-md-12'>
		<form class='form-inline' action='{{image_upload_url()}}' method='POST' enctype='multipart/form-data' id='uploadProblemImageFrm'>
			<label for="file">File:</label>
			<input type="file" name="file" id="file">
			<input type="submit" name="submit" value="Upload">

		</form>

			<hr>

			</div>
		</div>
		

		<div class='row'>

			<div class='col-md-4' ng-repeat='image in problem_images'>

				<center>
					<img ng-src='{{image.image}}' class='thumbnail small-img' ng-click='open_image_box(image)'>
					<br>
					
					<button class='btn btn-sm btn-default' ng-click='open_image_box(image)'> View </button>
					<button class='btn btn-sm btn-danger' ng-click='delete_problem_image(image)' ng-show='permitted(["delete_problem_image"])'>
						Delete 
					</button>
					<hr>
				</center>
			</div>

		</div>

	</div>

</div>


<!-- Relationships -->

<div class='panel panel-default'>

	<div class='panel-heading'> Relationships </div>

	<div class='panel-body' style='padding:20px;'>

<div class='row'>
	<div class='col-md-4'>

<h4> Effecting Problems <i class='glyphicon glyphicon-arrow-right'></i> </h4>
<div class='row' ng-repeat='eff_problem in patient_problems' style='padding:7px; border-bottom:1px solid #ccc;'>


<input type='checkbox'   ng-model='eff_problem.effecting' ng-change='change_effecting_problem(eff_problem, problem)' 
ng-disabled='!permitted(["relate_problem"])'> {{eff_problem.problem_name}}

</div>

	</div>

	<div class='col-md-3'>
<h3> {{problem.problem_name}} </h3>
	</div>

	<div class='col-md-4'>

<h4> <i class='glyphicon glyphicon-arrow-right'></i>  EffectedProblems </h4>
<div class='row' ng-repeat='eff_problem in patient_problems'  style='padding:7px; border-bottom:1px solid #ccc;'>

<input type='checkbox'  ng-model='eff_problem.effected' ng-change='change_effected_problem(problem, eff_problem)' ng-disabled='!permitted(["relate_problem"])'>  {{eff_problem.problem_name}}

</div>

	</div>


	</div>

</div>


<script type='text/javascript'>
/* To BE REPLACED BY ANGULARJS DIRECTIVE */

var options = {
	success: function(data){
		if(data['success']==true){
			alert("Uploaded Image!");
			location.reload();
		}else{
			alert("Something went wrong!");
		}
	}
};

$('#uploadProblemImageFrm').ajaxForm(options);

</script>








