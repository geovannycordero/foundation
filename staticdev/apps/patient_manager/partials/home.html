
<toaster-container></toaster-container>

<p style='padding-bottom:40px;'>
	
</p>

<div class='panel panel-default' ng-if="active_user.role!='patient'">
	<div class='panel-heading'>Note (office users only)</div>
	<div class='panel-body'>

		<div class='row'>

			<div class='col-md-12'>
				<textarea class='form-control' ng-model='patient_info.note'></textarea>
				<br>
				<button class='btn btn-default' ng-click='update_patient_note()'>
					Update
				</button>
			</div>
		</div>


	</div><!-- End of Panel Body -->
</div>

<div class='panel panel-default'>

	<div class='panel-body'>

		<div class='row'>

			<div class='col-md-12'>
				<img ng-src='{{patient_info.cover_image}}' class='img-responsive cover-image'> 
			</div>
		</div>


	</div><!-- End of Panel Body -->
</div>

<div class='panel panel-default'>

	<div class='panel-heading'>Patient Info</div>

	<div class='panel-body'>

		<div class='row'>

			<div class='col-md-4'>
				<img ng-src='{{patient_info.portrait_image}}' class='thumbnail thumbnail-custom'> 
			</div>

			<div class='col-md-8'>
				<strong> {{patient_info.user.first_name}} {{patient_info.user.last_name}} </strong>
				<a href='#/edit/'  class='btn btn-sm btn-default'>Edit</a>
				<hr>
				
				<textarea class='form-control' ng-model='patient_info.summary'></textarea>
				<br>
				<button class='btn btn-default' ng-click='update_patient_summary()' ng-show='permitted(["update_patient_profile"])'>
					Update
				</button>
			</div>

		</div>


	</div><!-- End of Panel Body -->
</div>
<hr>

<div class='panel panel-default' ng-show="user_id == patient_id">

	<div class='panel-heading'>
		Sharing care
	</div>

	<div class='panel-body'>
		<h4>People I can access:</h4>
		<table class='table'>
			<thead>
				<th> Name </th>
				<th> Actions </th>
			</thead>
			<tbody>
				<tr ng-repeat='p in shared_patients'>
					<td> {{p.user.first_name}} {{p.user.last_name}}
					</td>
					<td> 
						<a href="/u/patient/manage/{{p.user.id}}" class='btn btn-sm btn-default'>
                            Access chart
                        </a>
                        <a href="/u/patient/manage/{{p.user.id}}" class='btn btn-sm btn-default'>
                            Manage
                        </a>
					</td>
				</tr>
			</tbody>
		</table>
		<br>

		<h4>People that can access me:</h4>
		<table class='table'>
			<thead>
				<th> Name </th>
				<th> Actions </th>
			</thead>
			<tbody>
				<tr ng-repeat='p in shared_patients'>
					<td> {{p.user.first_name}} {{p.user.last_name}}
					</td>
					<td>
                        <a href="/u/patient/manage/{{p.user.id}}" class='btn btn-sm btn-default'>
                            Manage
                        </a>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

</div>
<hr>

<div class='panel panel-default'>

  <div class='panel-heading'> Labeled Problems Lists </div>

  <div class='panel-body'>
    <form class='form-inline' role='form' ng-submit='add_problem_list(new_list)'>
      <div class='form-group'>
        <label> Labeled Problems Lists Name </label>
        <input type='text' ng-model='new_list.name'>
        <br>
        <div class="quick-card-editor-label labeled-list">
          <div ng-repeat="label in problem_labels">
            <a href class="todo-label" ng-class="label.css_class" ng-click="add_new_list_label(new_list, label)">
              {{label.name}}
              <i class="fa fa-check" ng-repeat="l in new_list.labels" ng-if="l.id==label.id"></i>
            </a>
          </div>
        </div>
      </div>
      <br>
      <br>
      <button type='submit' class='btn btn-default'> Add List </button>
      <br>
    </form>
  </div>
</div>
<hr>

<div class='panel panel-default' ng-repeat="list in problem_lists" ng-init="list.collapse=false;list.rename=false;">

  <div class='panel-heading' ng-click="set_collapse(list);"> 
  	<i class="fa fa-caret-down" aria-hidden="true" ng-if="list.collapse"></i>
  	<i class="fa fa-caret-right" aria-hidden="true" ng-if="!list.collapse"></i>
  	<span ng-show="!list.rename"> {{list.name}} </span>
  	<span ng-show="list.rename"> 
  		<input type="text" ng-model="list.name"> 
  		<button class="btn btn-default" ng-click="rename_list(list); $event.stopPropagation();">Save</button>
  		<button class="btn btn-default" ng-click="list.rename=!list.rename; $event.stopPropagation();">Cancel</button>
  	</span>
	<span ng-show="list.collapse && !list.rename">
		<a href class="btn btn-danger" ng-click="delete_list(list); $event.stopPropagation();">Delete</a>
		<a href class="btn btn-primary" ng-click="list.rename=!list.rename; $event.stopPropagation();">Rename</a>
	</span>
  </div>

  <div class='panel-body' ng-show="list.collapse">
    <problem ng-model="list.problems" is-list="list.id"></problem>
  </div>
</div>
<hr>

<div class='row'>

	<div class='col-md-12'>

<div class='panel panel-default'>

	<div class='panel-heading'> Problems </div>

	<div class='panel-body'>

		<div class='row' ng-show='permitted(["add_problem"])'>
			<div class='col-md-12'>
			
					<input type='text' ng-model='problem_term' class='form-control' id='problemTermInput' placeholder='Search Problem....'>
					<button class='btn btn-sm btn-default' ng-click='add_new_problem(problem_term)'>
						Add Problem
					</button>
					

					<div ng-show='new_problem.set==true'>
						<hr>
						<label> {{new_problem.code}} </label>
						{{new_problem.term}} <br>
						<button class='btn btn-sm btn-default' ng-click='add_problem()'>
							Add Problem
						</button>
						<button class='btn btn-sm btn-default' ng-click='unset_new_problem()'>
							Cancel
						</button>
						<hr>
					</div>

			</div>
			<div class='col-md-12'  style='max-height:375px; overflow-y:auto;'>
				<div ng-repeat='problem_term in problem_terms' style='margin-top:12px;'>
					<button class='btn btn-sm btn-default' title='{{problem_term.code}}' ng-click='set_new_problem(problem_term)'>
						{{problem_term.term}}
					</button>
				</div>
			</div>
		</div>

		<hr>

<div class='row'>
	<div class='col-md-6 col-md-offset-4'>
  <ul class="nav nav-pills" role="tablist">
    <li role="presentation" class="active"><a href=".tab-active-problem" aria-controls="home" role="tab" data-toggle="tab">Active Problems</a></li>
    <li role="presentation"><a href=".tab-inactive-problem" aria-controls="profile" role="tab" data-toggle="tab">Inactive Problems</a></li>

  </ul>
</div>
</div>

  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active tab-active-problem" >

    	<div>
    		<ul class='ul-clean' ui-sortable="sortableOptionsProblem" ng-model="problems" ng-if="active_user.role=='physician' || active_user.role=='patient' || active_user.role=='mid-level'">
				<li ng-repeat="problem in problems" ng-show="problem.is_active==true" ng-click='open_problem(problem)'>
					<div class='item-box' ng-class='problem.is_controlled==true ? "green-box" : "red-box" '>
						{{problem.problem_name}} <span ng-show="problem.authenticated==false">(not authenticated)</span>
						<!-- begin label -->
						<div class="quick-card-editor-label">
							<a ng-repeat="label in problem.labels" class="todo-label" ng-class="label.css_class" ng-if="label.author.id==user_id"></a>
						</div>
						<!-- end label -->
					</div>
				</li>
			</ul>
		<ul class='ul-clean' ng-if="active_user.role=='admin' || active_user.role=='nurse' || active_user.role=='secretary'">
		<li  ng-repeat='problem in problems' ng-show="problem.is_active==true" ng-click='open_problem(problem)'>
			
			<div class='item-box' ng-class='problem.is_controlled==true ? "green-box" : "red-box" '>

				<a class='btn  btn-default btn-sm'  ng-click='open_problem(problem)'>
					View
				</a>

				{{problem.problem_name}} <span ng-show="problem.authenticated==false">(not authenticated)</span>

				<!-- begin label -->
				<div class="quick-card-editor-label">
					<a ng-repeat="label in problem.labels" class="todo-label" ng-class="label.css_class" ng-if="label.author.id==user_id"></a>
				</div>
				<!-- end label -->
			</div>
		</li>
		</ul>
	</div>


    </div>

    <div role="tabpanel" class="tab-pane  tab-inactive-problem" >

    	<div style='max-height:375px; overflow-y:auto;'>
    		<ul class='ul-clean' ui-sortable="sortableOptionsProblem" ng-model="problems" ng-if="active_user.role=='physician' || active_user.role=='patient' || active_user.role=='mid-level'">
				<li ng-repeat="problem in problems" ng-show="problem.is_active==false" ng-click='open_problem(problem)'>
					<div class='item-box' ng-class='problem.is_controlled==true ? "green-box" : "red-box" '>
						{{problem.problem_name}} <span ng-show="problem.authenticated==false">(not authenticated)</span>
						<!-- begin label -->
						<div class="quick-card-editor-label">
							<a ng-repeat="label in problem.labels" class="todo-label" ng-class="label.css_class" ng-if="label.author.id==user_id"></a>
						</div>
						<!-- end label -->
					</div>
				</li>
			</ul>

		<ul class='ul-clean' ng-if="active_user.role=='admin' || active_user.role=='nurse' || active_user.role=='secretary'">
		<li  ng-repeat='problem in problems'  ng-show="problem.is_active==false" ng-click='open_problem(problem)'>
			
			<div class='item-box' ng-class='problem.is_controlled==true ? "green-box" : "red-box" '>

				{{problem.problem_name}} <span ng-show="problem.authenticated==false">(not authenticated)</span>
				<!-- begin label -->
				<div class="quick-card-editor-label">
					<a ng-repeat="label in problem.labels" class="todo-label" ng-class="label.css_class" ng-if="label.author.id==user_id"></a>
				</div>
				<!-- end label -->
			</div>
		</li>
		</ul>
	</div>


    </div>



  </div>




	</div>
</div>

	</div>


	<div class='col-md-12'>

<div class='panel panel-default'>

	<div class='panel-heading'> Goals </div>

	<div class='panel-body'>


		<div class='row' ng-show='permitted(["add_goal"])'>
			<div class='col-md-10 col-md-offset-1'>


			<form   role='form' ng-submit='add_goal(new_goal)'>

				
				<div class='form-group'>
					<label> Goal Name </label>
					<input type='text' ng-model='new_goal.name' class='form-control'>
				</div>

				<button type='submit' class='btn btn-default'> Add Goal </button>

			</form>



			</div>	
		</div>

		<hr>

<div class='row'>
	<div class='col-md-6 col-md-offset-4'>
  <ul class="nav nav-pills" role="tablist">
  	<li role="presentation" class="active"><a href=".tab-incomplete-goals" aria-controls="goals" role="tab" data-toggle="tab"> Current/Incomplete Goals </a></li>
    <li role="presentation" ><a href=".tab-completed-goals" aria-controls="incomplete_goals" role="tab" data-toggle="tab">Completed Goals</a></li>
    

  </ul>
</div>
</div>

  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active tab-incomplete-goals">
    <div style='max-height:375px; overflow-y:auto;'>

		<ul class='ul-clean'>
		<li  ng-repeat='goal in goals'>
			<div class='item-box' ng-class='goal.is_controlled==true ? "green-box" : "red-box" '>
				<a class='btn  btn-default btn-sm' href='#/goal/{{goal.id}}'>
					View
				</a>

				{{goal.goal}} <span ng-if="goal.problem">for problem <a href="#/problem/{{goal.problem.id}}">{{goal.problem.problem_name}}</a></span>
			</div>
		</li>
		</ul>
	</div>

    </div>
    <div role="tabpanel" class="tab-pane tab-completed-goals" > 

    	<div style='max-height:375px; overflow-y:auto;'>

		<ul class='ul-clean'>
		<li  ng-repeat='goal in completed_goals'>
			<div class='item-box' ng-class='goal.is_controlled==true ? "green-box" : "red-box" '>
				<a class='btn  btn-default btn-sm' href='#/goal/{{goal.id}}'>
					View
				</a>

				{{goal.goal}} <span ng-if="goal.problem">for problem <a href="#/problem/{{goal.problem.id}}">{{goal.problem.problem_name}}</a></span>
			</div>
		</li>
		</ul>

	</div>

    </div>

  </div>


	</div>
</div>

	</div>

</div>



<div class='panel panel-default'>

	<div class='panel-heading'> Todos </div>

	<div class='panel-body'>

		<div class='row' ng-show='permitted(["add_todo"])'>
			<div class='col-md-12'>


			<form class='form-inline' role='form' ng-submit='add_todo(new_todo)'>
				<div class='form-group'>
					<label> Todo Name </label>
					<input type='text' ng-model='new_todo.name' id='todoNameInput'>
				</div>
				<!-- <div class='form-group'>
					<label> Problem (optional) </label>
					<input type='text' ng-model='new_todo.problem'>
				</div>
				<div class='form-group'>
					<label> Due Date </label>
					<input type='text' ng-model='new_todo.due_date' id='due_date'>
				</div> -->

				<button type='submit' class='btn btn-default'> Add Todo </button>

			</form>



			</div>	
		</div>

		<todo ng-model="problem_todos" accomplished="false" show-problem="true"></todo>
<hr>
		<a class='btn btn-default btn-md' ng-click='toggle_accomplished_todos()'> 
			<span ng-if='show_accomplished_todos==false'>Show accomplished Todos </span>
			<span ng-if='show_accomplished_todos==true'>Hide accomplished Todos </span>
		</a>
<hr>
		<div class="col-md-12" ng-show='show_accomplished_todos==true'>
		    <todo ng-model="problem_todos" accomplished="true" show-problem="true"></todo>
		</div>

	</div>
</div>



<div class='panel panel-default' ng-init="encounter_collapse=false;">

	<div class='panel-heading' ng-click="encounter_collapse=!encounter_collapse;"> 
		<i class="fa fa-caret-down" aria-hidden="true" ng-if="encounter_collapse"></i>
		<i class="fa fa-caret-right" aria-hidden="true" ng-if="!encounter_collapse"></i>
		Encounters </div>

	<div class='panel-body' style='max-height:325px; overflow:auto' ng-show="encounter_collapse">

		<ul class='ul-clean'>
		<li  ng-repeat='encounter in encounters'>

			<div class='row'>
				<div class='col-md-6'>
					<a href='#/encounter/{{encounter.id}}'>
			From <b> {{encounter.starttime | date:'medium'}} </b> to <b>{{encounter.stoptime | date:'medium'}}</b>  
					</a>
				</div>

				<div class='col-md-4'>
				{{encounter.duration}}
				</div>
		</li>
		</ul>

	</div>
</div>


<div class='panel panel-default'>

	<div class='panel-heading'> Pain History </div>

	<div class='panel-body'>

		<a href="/patient/{{patient_id}}/pain/add_pain_avatar" class='btn btn-default pull-right' ng-show='permitted(["update_pain"])'>
			Update Pain
		</a>
		<div pain-avatar  pain-data='pain_avatars'></div>

	</div>
</div>

<div class='row'>

	<div class='col-md-12'>

		<div class='panel panel-default'>

			<div class='panel-heading'> Problems </div>

			<div class='panel-body'>
				<problem-timeline ng-model="timeline"></problem-timeline>
			</div>
		</div>
	</div>
</div>
<hr>


<script type='text/javascript'>
	
	$(document).ready(function(){

		$( "#due_date" ).datepicker({ dateFormat: 'yy-mm-dd' });

	});
</script>




